// Source code generated by AppGPT (www.appgpt.tech)

 //Class to create tables and seed new database
import { DataSource } from "typeorm";
import { DBConfiguration } from "./Configuration";
import { SettingsEntity } from "./db/Settings.entity";
//autogenerate imports based on resources
import { UsersEntity } from "./db/Users.entity";
import { EmployeesEntity } from "./db/Employees.entity";
import { EvaluationsEntity } from "./db/Evaluations.entity";
import { PayrollEntity } from "./db/Payroll.entity";
import { LeaveRequestsEntity } from "./db/LeaveRequests.entity";

export class Database {
  static dbConfiguration: DBConfiguration;
  public static ds: DataSource;

  static async Initialize(dbConfiguration: DBConfiguration) {
    Database.dbConfiguration = dbConfiguration;
    let dbConfig: any = dbConfiguration as any;
    //Autogenerate entities array from resource names

    dbConfig.entities = [SettingsEntity, UsersEntity, EmployeesEntity, EvaluationsEntity, PayrollEntity, LeaveRequestsEntity];
    Database.ds = new DataSource(dbConfig);
    await Database.ds.initialize();

    //TODO: Drop all tables


    await Database.Seed();
  }
  static async Seed() {
    let data: any = {"Users":[{"userId":1,"name":"name 1","email":"email 1","password":"password 1","role":"role 1","id":27},{"userId":2,"name":"name 2","email":"email 2","password":"password 2","role":"role 2","id":46},{"userId":3,"name":"name 3","email":"email 3","password":"password 3","role":"role 3","id":69},{"userId":4,"name":"name 4","email":"email 4","password":"password 4","role":"role 4","id":36},{"userId":5,"name":"name 5","email":"email 5","password":"password 5","role":"role 5","id":91}],"Employees":[{"employeeId":1,"firstName":"firstName 1","lastName":"lastName 1","middleName":"middleName 1","dateOfBirth":"2023-06-04T21:45:03.582Z","gender":"gender 1","nationality":"nationality 1","maritalStatus":"maritalStatus 1","contactInformation":"contactInformation 1","address":"address 1","department":"department 1","position":"position 1","manager":"manager 1","employmentType":"employmentType 1","startDate":"2024-03-03T12:17:02.498Z","endDate":"2024-09-23T16:42:10.051Z","salaryInformation":0.31,"profilePicture":"profilePicture 1","id":81},{"employeeId":2,"firstName":"firstName 2","lastName":"lastName 2","middleName":"middleName 2","dateOfBirth":"2023-11-25T15:11:20.701Z","gender":"gender 2","nationality":"nationality 2","maritalStatus":"maritalStatus 2","contactInformation":"contactInformation 2","address":"address 2","department":"department 2","position":"position 2","manager":"manager 2","employmentType":"employmentType 2","startDate":"2023-06-27T19:13:52.314Z","endDate":"2024-02-20T21:31:39.951Z","salaryInformation":0.38,"profilePicture":"profilePicture 2","id":53},{"employeeId":3,"firstName":"firstName 3","lastName":"lastName 3","middleName":"middleName 3","dateOfBirth":"2023-08-04T00:56:06.698Z","gender":"gender 3","nationality":"nationality 3","maritalStatus":"maritalStatus 3","contactInformation":"contactInformation 3","address":"address 3","department":"department 3","position":"position 3","manager":"manager 3","employmentType":"employmentType 3","startDate":"2025-01-14T21:20:50.113Z","endDate":"2024-08-22T06:04:49.933Z","salaryInformation":0.84,"profilePicture":"profilePicture 3","id":54},{"employeeId":4,"firstName":"firstName 4","lastName":"lastName 4","middleName":"middleName 4","dateOfBirth":"2024-01-07T13:34:20.525Z","gender":"gender 4","nationality":"nationality 4","maritalStatus":"maritalStatus 4","contactInformation":"contactInformation 4","address":"address 4","department":"department 4","position":"position 4","manager":"manager 4","employmentType":"employmentType 4","startDate":"2024-03-24T19:26:56.842Z","endDate":"2025-02-25T06:30:16.086Z","salaryInformation":0.93,"profilePicture":"profilePicture 4","id":12},{"employeeId":5,"firstName":"firstName 5","lastName":"lastName 5","middleName":"middleName 5","dateOfBirth":"2024-12-13T23:43:42.464Z","gender":"gender 5","nationality":"nationality 5","maritalStatus":"maritalStatus 5","contactInformation":"contactInformation 5","address":"address 5","department":"department 5","position":"position 5","manager":"manager 5","employmentType":"employmentType 5","startDate":"2024-09-16T06:37:09.569Z","endDate":"2024-12-18T06:08:16.266Z","salaryInformation":0.7,"profilePicture":"profilePicture 5","id":100}],"Evaluations":[{"reviewId":1,"employeeId":1,"periodStart":"2023-08-05T03:36:43.105Z","periodEnd":"2024-02-04T16:00:39.074Z","goalsObjectives":"goalsObjectives 1","achievements":"achievements 1","improvementAreas":"improvementAreas 1","feedbackFromSupervisor":"feedbackFromSupervisor 1","overallRating":1,"recommendations":"recommendations 1","id":86},{"reviewId":2,"employeeId":2,"periodStart":"2023-10-12T12:02:42.593Z","periodEnd":"2025-02-26T15:24:06.070Z","goalsObjectives":"goalsObjectives 2","achievements":"achievements 2","improvementAreas":"improvementAreas 2","feedbackFromSupervisor":"feedbackFromSupervisor 2","overallRating":2,"recommendations":"recommendations 2","id":90},{"reviewId":3,"employeeId":3,"periodStart":"2024-11-10T08:01:56.157Z","periodEnd":"2023-05-16T18:42:33.363Z","goalsObjectives":"goalsObjectives 3","achievements":"achievements 3","improvementAreas":"improvementAreas 3","feedbackFromSupervisor":"feedbackFromSupervisor 3","overallRating":3,"recommendations":"recommendations 3","id":25},{"reviewId":4,"employeeId":4,"periodStart":"2024-08-14T20:03:46.249Z","periodEnd":"2024-01-27T15:40:04.216Z","goalsObjectives":"goalsObjectives 4","achievements":"achievements 4","improvementAreas":"improvementAreas 4","feedbackFromSupervisor":"feedbackFromSupervisor 4","overallRating":4,"recommendations":"recommendations 4","id":69},{"reviewId":5,"employeeId":5,"periodStart":"2023-05-28T06:38:35.161Z","periodEnd":"2024-11-09T20:14:44.282Z","goalsObjectives":"goalsObjectives 5","achievements":"achievements 5","improvementAreas":"improvementAreas 5","feedbackFromSupervisor":"feedbackFromSupervisor 5","overallRating":5,"recommendations":"recommendations 5","id":28}],"Payroll":[{"payrollId":1,"employeeId":1,"periodStartDate":"2023-06-27T22:45:14.083Z","periodEndDate":"2023-05-04T02:33:40.907Z","grossSalary":0.67,"deductions":0.9,"netSalary":0.41,"payDate":"2024-11-03T00:44:27.827Z","overtimeHours":1,"overtimePay":0.85,"id":44},{"payrollId":2,"employeeId":2,"periodStartDate":"2023-07-29T13:36:17.913Z","periodEndDate":"2023-04-19T04:41:58.417Z","grossSalary":0.29,"deductions":0.43,"netSalary":0.91,"payDate":"2024-11-22T22:57:48.564Z","overtimeHours":2,"overtimePay":0.41,"id":6},{"payrollId":3,"employeeId":3,"periodStartDate":"2023-05-20T22:32:17.052Z","periodEndDate":"2025-01-23T15:22:47.177Z","grossSalary":0.51,"deductions":0.07,"netSalary":0.89,"payDate":"2023-05-12T09:25:33.780Z","overtimeHours":3,"overtimePay":0.78,"id":83},{"payrollId":4,"employeeId":4,"periodStartDate":"2023-08-02T17:29:49.265Z","periodEndDate":"2023-10-18T13:19:28.895Z","grossSalary":0.7,"deductions":0.6,"netSalary":0.93,"payDate":"2025-01-13T17:32:06.259Z","overtimeHours":4,"overtimePay":0.2,"id":93},{"payrollId":5,"employeeId":5,"periodStartDate":"2024-02-13T20:56:44.564Z","periodEndDate":"2024-10-07T20:15:46.118Z","grossSalary":0.64,"deductions":0.3,"netSalary":0.37,"payDate":"2023-07-28T13:56:47.553Z","overtimeHours":5,"overtimePay":0.67,"id":77}],"LeaveRequests":[{"requestId":1,"employeeId":1,"typeOfLeave":"typeOfLeave 1","startDate":"2024-11-13T17:29:20.281Z","endDate":"2023-11-04T02:46:32.004Z","reason":"reason 1","approvalStatus":"approvalStatus 1","approverUserId":1,"id":34},{"requestId":2,"employeeId":2,"typeOfLeave":"typeOfLeave 2","startDate":"2023-04-17T01:40:50.430Z","endDate":"2024-08-22T03:43:00.569Z","reason":"reason 2","approvalStatus":"approvalStatus 2","approverUserId":2,"id":8},{"requestId":3,"employeeId":3,"typeOfLeave":"typeOfLeave 3","startDate":"2025-03-25T19:56:57.767Z","endDate":"2024-11-18T04:13:46.658Z","reason":"reason 3","approvalStatus":"approvalStatus 3","approverUserId":3,"id":51},{"requestId":4,"employeeId":4,"typeOfLeave":"typeOfLeave 4","startDate":"2024-09-16T06:33:58.649Z","endDate":"2024-08-19T18:38:48.874Z","reason":"reason 4","approvalStatus":"approvalStatus 4","approverUserId":4,"id":56},{"requestId":5,"employeeId":5,"typeOfLeave":"typeOfLeave 5","startDate":"2024-10-24T00:40:21.962Z","endDate":"2023-05-16T22:01:48.514Z","reason":"reason 5","approvalStatus":"approvalStatus 5","approverUserId":5,"id":84}]};
    //Autogenerate multiple such calls ie for each resource and its data object
    let isSeeded = await this.IsSeeded();
    //if (!isSeeded) {
    //forcing app recreation
    if (true){
      console.log('   Seeding database...');
      await this.SeedResource("UsersEntity", data.Users);
await this.SeedResource("EmployeesEntity", data.Employees);
await this.SeedResource("EvaluationsEntity", data.Evaluations);
await this.SeedResource("PayrollEntity", data.Payroll);
await this.SeedResource("LeaveRequestsEntity", data.LeaveRequests); 
      await this.SeedResource("SettingsEntity", {
        settingname: "isSeeded",
        settingvalue: "true",
      });
    }else{
      console.log('   Database seeded already!');
    }
  }
  static async IsSeeded() {
    const repo = Database.ds.getRepository("SettingsEntity");
    let rec: any = await repo.findOne({
      select: {
        settingname: true,
        settingvalue: true,
      },
      where: {
        settingname: "isSeeded",
      },
    });
    if (rec && rec.settingvalue) return true;
    return false;
  }
  static async SeedResource(resourceName: any, resourceData: any) {
    const repo = Database.ds.getRepository(resourceName);
    //await repo.clear();
    console.log('   Seeding table '+resourceName);
    await repo.upsert(resourceData, ["id"]);
  }
}

