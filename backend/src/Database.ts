// Source code generated by AppGPT (www.appgpt.tech)

 //Class to create tables and seed new database
import { DataSource } from "typeorm";
import { DBConfiguration } from "./Configuration";
import { SettingsEntity } from "./db/Settings.entity";
//autogenerate imports based on resources
import { UsersEntity } from "./db/Users.entity";
import { EmployeesEntity } from "./db/Employees.entity";
import { EvaluationsEntity } from "./db/Evaluations.entity";
import { PayrollEntity } from "./db/Payroll.entity";
import { LeaveRequestsEntity } from "./db/LeaveRequests.entity";

export class Database {
  static dbConfiguration: DBConfiguration;
  public static ds: DataSource;

  static async Initialize(dbConfiguration: DBConfiguration) {
    Database.dbConfiguration = dbConfiguration;
    let dbConfig: any = dbConfiguration as any;
    //Autogenerate entities array from resource names

    dbConfig.entities = [SettingsEntity, UsersEntity, EmployeesEntity, EvaluationsEntity, PayrollEntity, LeaveRequestsEntity];
    Database.ds = new DataSource(dbConfig);
    await Database.ds.initialize();

    //TODO: Drop all tables


    await Database.Seed();
  }
  static async Seed() {
    let data: any = {"Users":[{"userId":1,"name":"name 1","email":"email 1","password":"password 1","role":"role 1","id":62},{"userId":2,"name":"name 2","email":"email 2","password":"password 2","role":"role 2","id":99},{"userId":3,"name":"name 3","email":"email 3","password":"password 3","role":"role 3","id":88},{"userId":4,"name":"name 4","email":"email 4","password":"password 4","role":"role 4","id":1},{"userId":5,"name":"name 5","email":"email 5","password":"password 5","role":"role 5","id":5}],"Employees":[{"employeeId":1,"firstName":"firstName 1","lastName":"lastName 1","middleName":"middleName 1","dateOfBirth":"2025-02-12T07:56:41.628Z","gender":"gender 1","nationality":"nationality 1","maritalStatus":"maritalStatus 1","contactInformation":"contactInformation 1","address":"address 1","department":"department 1","position":"position 1","manager":"manager 1","employmentType":"employmentType 1","startDate":"2024-12-13T07:44:25.677Z","endDate":"2024-12-16T09:32:11.251Z","salaryInformation":0.64,"profilePicture":"profilePicture 1","id":64},{"employeeId":2,"firstName":"firstName 2","lastName":"lastName 2","middleName":"middleName 2","dateOfBirth":"2023-08-01T08:01:52.032Z","gender":"gender 2","nationality":"nationality 2","maritalStatus":"maritalStatus 2","contactInformation":"contactInformation 2","address":"address 2","department":"department 2","position":"position 2","manager":"manager 2","employmentType":"employmentType 2","startDate":"2025-03-11T09:53:01.530Z","endDate":"2023-12-06T05:36:38.408Z","salaryInformation":0.5,"profilePicture":"profilePicture 2","id":16},{"employeeId":3,"firstName":"firstName 3","lastName":"lastName 3","middleName":"middleName 3","dateOfBirth":"2024-06-06T12:13:50.578Z","gender":"gender 3","nationality":"nationality 3","maritalStatus":"maritalStatus 3","contactInformation":"contactInformation 3","address":"address 3","department":"department 3","position":"position 3","manager":"manager 3","employmentType":"employmentType 3","startDate":"2024-06-30T20:29:50.344Z","endDate":"2024-08-15T20:53:55.463Z","salaryInformation":0.53,"profilePicture":"profilePicture 3","id":4},{"employeeId":4,"firstName":"firstName 4","lastName":"lastName 4","middleName":"middleName 4","dateOfBirth":"2024-06-21T21:29:09.770Z","gender":"gender 4","nationality":"nationality 4","maritalStatus":"maritalStatus 4","contactInformation":"contactInformation 4","address":"address 4","department":"department 4","position":"position 4","manager":"manager 4","employmentType":"employmentType 4","startDate":"2024-01-18T10:09:28.819Z","endDate":"2023-07-25T00:45:01.633Z","salaryInformation":0.03,"profilePicture":"profilePicture 4","id":78},{"employeeId":5,"firstName":"firstName 5","lastName":"lastName 5","middleName":"middleName 5","dateOfBirth":"2023-12-05T09:07:58.207Z","gender":"gender 5","nationality":"nationality 5","maritalStatus":"maritalStatus 5","contactInformation":"contactInformation 5","address":"address 5","department":"department 5","position":"position 5","manager":"manager 5","employmentType":"employmentType 5","startDate":"2023-10-30T10:20:47.307Z","endDate":"2025-02-02T22:35:09.169Z","salaryInformation":0.52,"profilePicture":"profilePicture 5","id":74}],"Evaluations":[{"reviewId":1,"employeeId":1,"periodStart":"2024-12-14T18:38:32.975Z","periodEnd":"2023-09-17T14:55:55.972Z","goalsObjectives":"goalsObjectives 1","achievements":"achievements 1","improvementAreas":"improvementAreas 1","feedbackFromSupervisor":"feedbackFromSupervisor 1","overallRating":1,"recommendations":"recommendations 1","id":62},{"reviewId":2,"employeeId":2,"periodStart":"2024-09-27T23:00:48.198Z","periodEnd":"2023-04-02T00:11:16.724Z","goalsObjectives":"goalsObjectives 2","achievements":"achievements 2","improvementAreas":"improvementAreas 2","feedbackFromSupervisor":"feedbackFromSupervisor 2","overallRating":2,"recommendations":"recommendations 2","id":86},{"reviewId":3,"employeeId":3,"periodStart":"2025-02-26T21:08:25.107Z","periodEnd":"2024-10-21T15:08:30.382Z","goalsObjectives":"goalsObjectives 3","achievements":"achievements 3","improvementAreas":"improvementAreas 3","feedbackFromSupervisor":"feedbackFromSupervisor 3","overallRating":3,"recommendations":"recommendations 3","id":33},{"reviewId":4,"employeeId":4,"periodStart":"2024-09-06T02:05:59.404Z","periodEnd":"2025-02-28T03:19:18.373Z","goalsObjectives":"goalsObjectives 4","achievements":"achievements 4","improvementAreas":"improvementAreas 4","feedbackFromSupervisor":"feedbackFromSupervisor 4","overallRating":4,"recommendations":"recommendations 4","id":58},{"reviewId":5,"employeeId":5,"periodStart":"2023-07-28T21:34:52.838Z","periodEnd":"2023-07-19T20:38:14.319Z","goalsObjectives":"goalsObjectives 5","achievements":"achievements 5","improvementAreas":"improvementAreas 5","feedbackFromSupervisor":"feedbackFromSupervisor 5","overallRating":5,"recommendations":"recommendations 5","id":64}],"Payroll":[{"payrollId":1,"employeeId":1,"periodStartDate":"2024-06-27T12:21:04.572Z","periodEndDate":"2024-11-11T16:20:26.761Z","grossSalary":0.41,"deductions":0.03,"netSalary":0.8,"payDate":"2024-09-23T10:20:28.076Z","overtimeHours":1,"overtimePay":0.36,"id":66},{"payrollId":2,"employeeId":2,"periodStartDate":"2024-12-08T07:09:31.263Z","periodEndDate":"2023-07-15T11:58:37.223Z","grossSalary":0.92,"deductions":0,"netSalary":0.12,"payDate":"2024-06-05T04:40:39.112Z","overtimeHours":2,"overtimePay":0.59,"id":20},{"payrollId":3,"employeeId":3,"periodStartDate":"2025-03-17T20:47:00.880Z","periodEndDate":"2023-04-18T23:29:02.968Z","grossSalary":0.62,"deductions":0.55,"netSalary":0.68,"payDate":"2023-11-24T01:09:42.642Z","overtimeHours":3,"overtimePay":0.06,"id":80},{"payrollId":4,"employeeId":4,"periodStartDate":"2024-08-19T08:02:51.992Z","periodEndDate":"2024-04-07T08:28:28.950Z","grossSalary":0.51,"deductions":0.58,"netSalary":0.72,"payDate":"2023-04-20T16:14:38.354Z","overtimeHours":4,"overtimePay":1,"id":63},{"payrollId":5,"employeeId":5,"periodStartDate":"2024-02-06T14:23:35.765Z","periodEndDate":"2024-10-11T13:54:12.846Z","grossSalary":0.06,"deductions":0.84,"netSalary":0.56,"payDate":"2024-06-15T04:57:10.130Z","overtimeHours":5,"overtimePay":0.94,"id":57}],"LeaveRequests":[{"requestId":1,"employeeId":1,"typeOfLeave":"typeOfLeave 1","startDate":"2025-02-23T22:33:28.846Z","endDate":"2023-09-29T05:26:43.889Z","reason":"reason 1","approvalStatus":"approvalStatus 1","approverUserId":1,"id":100},{"requestId":2,"employeeId":2,"typeOfLeave":"typeOfLeave 2","startDate":"2024-02-03T20:30:15.660Z","endDate":"2023-06-06T22:49:16.179Z","reason":"reason 2","approvalStatus":"approvalStatus 2","approverUserId":2,"id":29},{"requestId":3,"employeeId":3,"typeOfLeave":"typeOfLeave 3","startDate":"2023-04-19T20:15:06.780Z","endDate":"2023-11-11T02:33:55.900Z","reason":"reason 3","approvalStatus":"approvalStatus 3","approverUserId":3,"id":96},{"requestId":4,"employeeId":4,"typeOfLeave":"typeOfLeave 4","startDate":"2025-01-07T22:58:40.290Z","endDate":"2023-07-11T14:02:08.311Z","reason":"reason 4","approvalStatus":"approvalStatus 4","approverUserId":4,"id":23},{"requestId":5,"employeeId":5,"typeOfLeave":"typeOfLeave 5","startDate":"2023-10-30T06:43:49.104Z","endDate":"2024-11-27T19:36:15.564Z","reason":"reason 5","approvalStatus":"approvalStatus 5","approverUserId":5,"id":35}]};
    //Autogenerate multiple such calls ie for each resource and its data object
    let isSeeded = await this.IsSeeded();
    //if (!isSeeded) {
    //forcing app recreation
    if (true){
      console.log('   Seeding database...');
      await this.SeedResource("UsersEntity", data.Users);
await this.SeedResource("EmployeesEntity", data.Employees);
await this.SeedResource("EvaluationsEntity", data.Evaluations);
await this.SeedResource("PayrollEntity", data.Payroll);
await this.SeedResource("LeaveRequestsEntity", data.LeaveRequests); 
      await this.SeedResource("SettingsEntity", {
        settingname: "isSeeded",
        settingvalue: "true",
      });
    }else{
      console.log('   Database seeded already!');
    }
  }
  static async IsSeeded() {
    const repo = Database.ds.getRepository("SettingsEntity");
    let rec: any = await repo.findOne({
      select: {
        settingname: true,
        settingvalue: true,
      },
      where: {
        settingname: "isSeeded",
      },
    });
    if (rec && rec.settingvalue) return true;
    return false;
  }
  static async SeedResource(resourceName: any, resourceData: any) {
    const repo = Database.ds.getRepository(resourceName);
    //await repo.clear();
    console.log('   Seeding table '+resourceName);
    await repo.upsert(resourceData, ["id"]);
  }
}

